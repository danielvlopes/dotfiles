#!/usr/bin/env ruby
require "thor"

class MyCLI < Thor
  # cli download production
  desc "download", "production database"
  def download(remote)
    puts "Downloading... #{remote}"
    system "heroku pgbackups:capture --expire --remote #{remote}"
    system "curl `heroku pgbackups:url --remote #{remote}` -o #{remote}.dump"
    puts "Done!"
  end

  # cli restore production lantern
  desc "restore", "load dump in dev database"
  def restore(remote, db)
    system "ps ax | grep postgres: | grep #{db} | cut -c1-8 | xargs kill"
    system "dropdb #{db}; createdb #{db}"
    system "pg_restore --verbose --clean --no-acl --no-owner -d #{db} #{remote}.dump"
    system "touch tmp/restart.txt"
  end
end

MyCLI.start(ARGV)